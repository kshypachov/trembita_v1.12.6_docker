{{- define "trembita-1.12.6-ss.initContainers" }}
initContainers:
  {{- range $name, $cfg := .Values.persistentVolumes }}
  {{- if $cfg.enabled }}
  - name: init-copy-{{ $name }}
    image: {{ $.Values.image.repository }}:{{ $.Values.image.tag | default $.Chart.AppVersion }}
    command: ["/bin/sh", "-c"]
    args:
      - >
        if [ -d "{{ $cfg.mountPath }}" ]; then
          cp -a {{ $cfg.mountPath }}/. /mnt/target/;
          {{- if and $cfg.uid $cfg.gid }}
          chown -R {{ $cfg.uid }}:{{ $cfg.gid }} /mnt/target;
          {{- end }}
        fi
      # защита от несуществующего пути и отсутствующих UID/GID
    volumeMounts:
      - name: {{ $name }}
        mountPath: /mnt/target
  {{- end }}
  {{- end }}
{{- end }}